{% load static %}

<nav class="bg-white dark:bg-dark-second
            h-14 w-full shadow
            flex items-center justify-between
            fixed top-0 z-50 border-b dark:border-dark-third">


    <!-- LEFT NAV -->
    <div class="flex items-center justify-between w-full md:w-max px-4 py-2">

            {% if user.is_authenticated %}
            <a href="{% url 'home' %}" class="mr-2 hidden md:inline-block">
                <img src="{% static 'img/logo.png' %}" alt="miLogo"
                    class="w-24 sm:w-20 lg:w-10 h-auto">
            </a>
            <form action="{% url 'search:results' %}" method="get" class="w-full">
                <input
                    type="text"
                    name="q"
                    placeholder="Search..."
                    value="{{ request.GET.q }}"
                    class="w-full px-3 py-2 rounded-lg"
                >
            </form>
            {% endif %}
        </div>
    <!-- END LEFT NAV -->

    <!-- MAIN NAV -->
    {% if user.is_authenticated %}
    <ul class="flex w-full lg:w-max items-center justify-center">

        <!-- HOME -->
        <li class="w-1/5 md:w-max text-center">
            <a href="{% url 'foster:list' %}"
               class="w-full text-3xl py-2 px-4 xl:px-12 inline-block
               {% if request.resolver_match.url_name == 'foster' %}
                   text-blue-500 border-b-4 border-blue-500
               {% else %}
                   text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third
               {% endif %}">
                <i class='bx bxs-home'></i>
            </a>
        </li>

        <!-- REELS -->
        <li class="w-1/5 md:w-max text-center">
            <a href="{% url 'reels:list' %}"
               class="w-full text-3xl py-2 px-4 xl:px-12 inline-block
               {% if request.resolver_match.url_name == 'reels' %}
                   text-blue-500 border-b-4 border-blue-500
               {% else %}
                   text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third
               {% endif %}">
                <i class='bx bx-movie-play'></i>
            </a>
        </li>

        <!-- STORE -->
        <li class="w-1/5 md:w-max text-center">
            <a href="{% url 'store:list' %}"
               class="w-full text-3xl py-2 px-4 xl:px-12 inline-block
               {% if request.resolver_match.app_name == 'store' %}
                   text-blue-500 border-b-4 border-blue-500
               {% else %}
                   text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third
               {% endif %}">
                <i class='bx bx-store'></i>
            </a>
        </li>

        <!-- GROUPS -->
        <li class="w-1/5 md:w-max text-center">
            <a href="{% url 'groups:list' %}"
               class="w-full text-3xl py-2 px-4 xl:px-12 inline-block
               {% if request.resolver_match.url_name == 'groups' %}
                   text-blue-500 border-b-4 border-blue-500
               {% else %}
                   text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third
               {% endif %}">
                <i class='bx bx-group'></i>
            </a>
        </li>

        <!-- STORE -->
        <li class="w-1/5 md:w-max text-center">
            <a href="{% url 'lost_found:feed' %}"
               class="w-full text-3xl py-2 px-4 xl:px-12 inline-block
               {% if request.resolver_match.app_name == 'lost_found' %}
                   text-blue-500 border-b-4 border-blue-500
               {% else %}
                   text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third
               {% endif %}">
                <i class='bx bx-search-alt'></i>
            </a>
        </li>

        <!-- STORE -->
        <li class="w-1/5 md:w-max text-center">
            <a href="{% url 'parroquiales:list' %}"
               class="w-full text-3xl py-2 px-4 xl:px-12 inline-block
               {% if request.resolver_match.app_name == 'parroquiales' %}
                   text-blue-500 border-b-4 border-blue-500
               {% else %}
                   text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third
               {% endif %}">
                <i class='bx bx-plus-medical'></i>
            </a>
        </li>

        <!-- MENU -->
        <li class="hidden md:block text-center">
            <button class="text-3xl py-2 px-4 xl:px-12 text-gray-600 hover:bg-gray-100 dark:text-dark-txt dark:hover:bg-dark-third">
                <i class='bx bx-menu'></i>
            </button>
        </li>

    </ul>
    {% endif %}
    <!-- END MAIN NAV -->

    <!-- RIGHT NAV -->
    <ul class="hidden md:flex mx-4 items-center justify-center">
        {% if not user.is_authenticated %}
        
            <a href="{% url 'account_login' %}" class="inline-flex items-center justify-center p-1 rounded-full hover:bg-gray-200 dark:hover:bg-dark-third mx-1">
                
                <span class="mx-2 font-semibold dark:text-dark-txt">Login</span>
            </a>
            <a href="{% url 'account_signup' %}" class="inline-flex items-center justify-center p-1 rounded-full hover:text-white  hover:bg-blue-600 dark:hover:bg-dark-third mx-1">
                
                <span class="mx-2 font-semibold dark:text-dark-txt">Register</span>
            </a>
        
        {% else %}
        <div x-data="{ openMessages: false }" class="relative">

            <!-- ICON -->
            <button @click="openMessages = !openMessages"
                    class="relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-dark-third">

                ðŸ’¬

                {% if nav_conversations %}
                <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                {% endif %}
            </button>

            <!-- DROPDOWN -->
            <div x-show="openMessages"
                @click.away="openMessages = false"
                class="absolute right-0 mt-2 w-80 bg-white dark:bg-dark-second
                        border border-gray-200 dark:border-dark-third
                        rounded-lg shadow-lg z-50">

                {% include "components/messages/messages_preview.html" %}

            </div>
        </div>

        <li class="h-full xl:flex">
            <a href="#" class="inline-flex items-center justify-center p-1 rounded-full hover:bg-gray-200 dark:hover:bg-dark-third mx-1">
                <i class='bx bx-coin text-yellow-400'></i>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <span class="mx-2 font-semibold dark:text-dark-txt">{{user.profile.coins}}</span>
            </a>
        </li>

        <li>
  <div x-data="{ open: false }" class="relative">

    <!-- ðŸ”” Bell -->
    <div
      @click="open = !open"
      class="text-xl grid place-items-center bg-gray-200 dark:bg-dark-third dark:text-dark-txt
             rounded-full mx-1 p-3 cursor-pointer hover:bg-gray-300 relative"
    >
      <i class="bx bxs-bell"></i>

      {% if notifications_count > 0 %}
      <span
        class="text-xs absolute -top-1 -right-1 bg-red-500 text-white
               font-semibold rounded-full px-1"
      >
        {{ notifications_count }}
      </span>
      {% endif %}
    </div>

    <!-- ðŸ“© Dropdown -->
    <div
      x-show="open"
      @click.away="open = false"
      x-transition
      class="absolute right-0 mt-2 w-72 rounded-md shadow-lg
             bg-white dark:bg-dark-second ring-1 ring-black ring-opacity-5 z-50"
    >
    <div class="py-1 max-h-80 overflow-y-auto">

        {% for n in user.notifications.all|slice:":5" %}
          <a
            href="{% url 'notifications:go' n.id %}"
            class="block px-4 py-2 text-sm
                   {% if not n.is_read %}
                     font-semibold bg-gray-100 dark:bg-dark-third
                   {% endif %}
                   hover:bg-gray-200 dark:hover:bg-dark-third"
          >
            {{ n.text }}
          </a>
        {% empty %}
          <span class="block px-4 py-2 text-sm text-gray-400">
            No hay notificaciones
          </span>
        {% endfor %}
    </div>

                <div x-show="open" @click.away="open=false" class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg dark:bg-dark-second bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                    <div class="py-1" role="menuiten">
                    <!-- Active: "bg-gray-100 text-gray-900", Not Active: "text-gray-700" -->
                    <a href="{% url 'account_settings' %}" class="text-gray-700 dark:text-dark-txt block px-4 py-2 text-sm" role="menuitem" tabindex="-1" id="menu-item-0">Account settings</a>
                    <a href="#" class="text-gray-700 dark:text-dark-txt block px-4 py-2 text-sm" role="menuitem" tabindex="-1" id="menu-item-1">Support</a>
                    <a href="#" class="text-gray-700 dark:text-dark-txt block px-4 py-2 text-sm" role="menuitem" tabindex="-1" id="menu-item-2">License</a>
                       
                    {% if user.is_authenticated %}
                    <a href="{% url 'account_logout' %}" class="text-gray-700 dark:text-dark-txt block px-4 py-2 text-sm" role="menuitem" tabindex="-1" id="menu-item-0">Sign Out</a>
                    {% endif %}
                    </div>
                </div>
            </div>

        </li>
        <li>
            <button id="theme-toggle"
           class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-dark-third transition">
                ðŸŒ™
            </button>

        </li>
        {% endif %}
    </ul>
    <!-- END RIGHT NAV -->

</nav>

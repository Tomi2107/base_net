{% extends "base.html" %}
{% load static %}

{% block title %}inbox{% endblock %}

{% block navbar %}
{% include 'components/navbar.html' %}
{% endblock navbar %}

{% block left_sidebar %}
{% include 'components/sidebars/left/sidebar.html' %}
{% endblock left_sidebar %}

{% block right_sidebar %}
{% include 'components/sidebars/right/sidebar.html' %}
{% endblock right_sidebar %}

{% block content %}

<div class="flex h-screen">

    <!-- LEFT: CHAT LIST -->
    <div class="w-1/3 border-r dark:border-dark-third overflow-y-auto">

        {% for item in conversations %}
        <a href="{% url 'messaging:conversation_detail' item.conversation.id %}"
        class="flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-dark-third">

            <!-- Avatar -->
            <img src="{{ item.other_user.profile.picture.url }}"
                class="w-12 h-12 rounded-full object-cover" alt="avatar">

            <!-- Info -->
            <div class="flex-1 min-w-0">
                <p class="font-semibold text-sm dark:text-dark-txt truncate">
                    {{ item.other_user.username }}
                </p>

                {% if item.last_message %}
                <p class="text-xs text-gray-500 truncate">
                    {{ item.last_message.body }}
                </p>
                {% endif %}
            </div>

            <!-- Right info -->
            <div class="text-right">
                {% if item.unread_count > 0 %}
                    <span class="bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">
                        {{ item.unread_count }}
                    </span>
                {% elif item.last_message %}
                    <span class="text-xs text-gray-400">
                        {{ item.last_message.created_at|date:"H:i" }}
                    </span>
                {% endif %}
            </div>

        </a>
        {% endfor %}

    </div>


</div>
{% endblock content %}